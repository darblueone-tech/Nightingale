name: Chat App & Clinical AI Test Runner

on:
  push:
    branches: [ main, dev ]
  pull_request:
    branches: [ main ]

jobs:
  test-process:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      # --- 1. Node.js 测试部分 (保留你原有的) ---
      - name: Setup Node.js environment
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: Install JS dependencies
        run: npm install

      - name: Run JS tests
        run: npm test

      # --- 2. Python 测试部分 (新增内容) ---
      - name: Set up Python environment
        uses: actions/setup-python@v5
        with:
          python-version: '3.10' # 建议使用 3.10 或以上版本

      - name: Install Python dependencies
        run: |
          python -m pip install --upgrade pip
          # 确保安装了 pytest 和 pydantic (上个代码用到了)
          pip install pytest pydantic 
          # 如果你有 requirements.txt，也可以用这一行：
          # if [ -f requirements.txt ]; then pip install -r requirements.txt; fi

      - name: Run Python Clinical AI tests
        run: |
          # 使用 -v 看到每个详细用例，使用 -s 看到 print 输出
          pytest -v -s
